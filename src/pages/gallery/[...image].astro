---
import { getCollection } from "astro:content";
import MinimalPage from "../../layouts/pages/MinimalPage.astro";
import type { InferGetStaticPropsType } from "astro";
import BaseHead from "../../layouts/BaseHead.astro";
import SocialImage from "../../layouts/SocialImage.astro";
import ResponsiveImage from "../../layouts/ResponsiveImage.astro";
import FormattedDateTime from "../../layouts/FormattedDateTime.astro";


export async function getStaticPaths() {
  return (await getCollection("imageMetadata")).map(m => ({ params: { image: m.id }, props: m }));
}

type Props = InferGetStaticPropsType<typeof getStaticPaths>;
const { data, filePath = "xxxx" } = Astro.props;
const { title, metadata } = data;
const { captureDate, iso, aperture, shutter, camera, lens } = metadata ?? {};
const image = filePath.substring(4, filePath.lastIndexOf("."));


if (!title) {
  return;
}
---
<MinimalPage>
  <BaseHead title={title} slot="head">
    <SocialImage name={image} />
  </BaseHead>
  <h1>{title}</h1>

  <ResponsiveImage name={image} />

  {metadata && (
    <h2>Metadaten</h2>
    <div class="flex justify-center">
      <table class="table rounded-lg border border-base-300 md:w-1/2 xl:w-1/3">
        <tbody>
        {captureDate && (
          <tr>
            <th class="inline-flex items-center gap-x-2"><span class="material-symbols--calendar-today"></span>
              Aufnahmedatum
            </th>
            <td class="font-mono">
              <FormattedDateTime date={captureDate} />
            </td>
          </tr>
        )}
        {aperture && (
          <tr>
            <th class="inline-flex items-center gap-x-2">
              <span class="material-symbols--camera"></span> Blende
            </th>
            <td class="font-mono">{aperture}</td>
          </tr>
        )}
        {shutter && (
          <tr>
            <th class="inline-flex items-center gap-x-2"><span class="material-symbols--shutter-speed"></span>
              Verschlusszeit
            </th>
            <td class="font-mono">{shutter} s</td>
          </tr>
        )}
        {iso && (
          <tr>
            <th class="inline-flex items-center gap-x-2"><span class="material-symbols--exposure"></span>
              ISO
            </th>
            <td class="font-mono">{iso}</td>
          </tr>
        )}
        {camera && (
          <tr>
            <th class="inline-flex items-center gap-x-2"><span class="material-symbols--photo-camera"></span>
              Kamera
            </th>
            <td class="font-mono">{camera}</td>
          </tr>
        )}
        {lens && (
          <tr>
            <th class="inline-flex items-center gap-x-2"><span class="material-symbols--camera"></span>
              Objektiv
            </th>
            <td class="font-mono">{lens}</td>
          </tr>
        )}
        </tbody>
      </table>
    </div>
  )}
</MinimalPage>