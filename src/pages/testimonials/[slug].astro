---
import type { InferGetStaticPropsType } from "astro";
import { getCollection } from "astro:content";

import { filterInvalidImageName } from "../../images/Images";
import BaseHead from "../../layouts/BaseHead.astro";
import MinimalPage from "../../layouts/pages/MinimalPage.astro";
import ReviewCard from "../../layouts/ReviewCard.astro";
import SocialImage from "../../layouts/SocialImage.astro";

export async function getStaticPaths() {
  return (await getCollection("testimonials")).map(r => ({
    params: { slug: r.slug },
    props: r
  }));

}

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const props = Astro.props;
const { data, slug } = props;
const { name, large } = data;
const title = `Eine ehrliche Bewertung von ${name}`;
const socialImage = filterInvalidImageName(large ?? `${slug}-large`);
---
<MinimalPage>
  <BaseHead title={title} author={name} slot="head">
    <SocialImage name={socialImage} />
  </BaseHead>
  <div class="mb-6 mt-2">
    <ReviewCard {...props} />
  </div>
</MinimalPage>
