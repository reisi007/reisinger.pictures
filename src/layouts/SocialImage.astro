---
import { getImage } from "astro:assets";
import { getImageByName, getImageNameByName } from "../images/Images";
import { getMetadataFromAbsoluteName } from "./image.utils";

interface Props {
  name?: string,
  folder?: string
}

const { name, folder } = Astro.props;

if (name === undefined) return;

const absoluteName = getImageNameByName(name, folder === undefined ? [] : [folder]);
const socialImage = getImageByName(absoluteName);
const alt = (await getMetadataFromAbsoluteName(absoluteName))?.title;

const imageInfo = await getImage({
  src: socialImage,
  format: "webp",
  width: 1200,
  height: 630,
  fit: "cover"
});

const { src, options } = imageInfo;
const fullSrc = Astro.url.href.replace(/(\w[/]).+/,"$1") + src.substring(1);
const { width, height, format } = options;
---
<meta property="og:image" content={fullSrc} />
<meta property="og:image:width" content={`${width}`} />
<meta property="og:image:height" content={`${height}`} />
<meta property="og:image:type" content={format} />
<meta property="twitter:image" content={fullSrc} />
<meta property="twitter:image:alt" content={alt} />
<meta property="twitter:card" content={fullSrc} />
